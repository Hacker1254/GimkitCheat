javascript: class multiple_choice{constructor(e=[],t=[],n=[]){this.correctAnswers=e,this.unknownAnswers=n,this.incorrectAnswers=t}static answer(e,t=[]){MC.savedText.includes(e)||multiple_choice.addQuestion(e,[],[],t);var n=MC.savedAnswers[MC.savedText.indexOf(e)];0==t.length&&(t=t.concat(n.correctAnswers).concat(n.unknownAnswers).concat(n.incorrectAnswers));for(var s=[],a=[],r=[],l=0;l<t.length;l++)n.correctAnswers.includes(t[l])?s.push(t[l]):n.incorrectAnswers.includes(t[l])?a.push(t[l]):r.push(t[l]);return{correct:s,wrong:a,unknown:r}}static addQuestion(e,t=[],n=[],s=[]){MC.savedText.push(e);var a=new multiple_choice(t,n,s);MC.savedAnswers.push(a)}static modifyAnswers(e,t=[],n=[],s=[]){for(var a=0;a<s.length;a++)e.correctAnswers.includes(s[a])||e.incorrectAnswers.includes(s[a])||e.unknownAnswers.includes(s[a])||e.unknownAnswers.push(s[a]);for(a=0;a<t.length;a++)e.unknownAnswers.includes(t[a])&&e.unknownAnswers.splice(e.unknownAnswers.indexOf(t[a]),1),e.correctAnswers.includes(t[a])||e.correctAnswers.push(t[a]);for(a=0;a<n.length;a++)e.unknownAnswers.includes(n[a])&&e.unknownAnswers.splice(e.unknownAnswers.indexOf(n[a]),1),e.incorrectAnswers.includes(n[a])||e.incorrectAnswers.push(n[a])}static setUp(){for(var e=1;e<document.getElementsByClassName("notranslate lang-en").length;e++)document.getElementsByClassName("notranslate lang-en")[e].parentElement.parentElement.addEventListener("click",e=>{CURRENTANSWER=e.srcElement.textContent,questionObserver()})}static displayAnswers(e){for(var t=1;t<document.getElementsByClassName("notranslate lang-en").length;t++){var n=document.getElementsByClassName("notranslate lang-en")[t];e.correct.includes(n.textContent)?n.parentElement.parentElement.style.backgroundColor="#00FF00":e.wrong.includes(n.textContent)?n.parentElement.parentElement.style.backgroundColor="#FF0000":n.parentElement.parentElement.style.backgroundColor="#777777"}}}class text_response{constructor(e=""){this.answer=e}static answer(e){return TR.savedText.includes(e)||text_response.addQuestion(e),TR.savedAnswers[TR.savedText.indexOf(e)].answer}static addQuestion(e,t=""){TR.savedText.push(e);var n=new text_response(t);TR.savedAnswers.push(n)}static modifyAnswers(e,t){e.answer=t}static setUp(){document.forms[0].children[0].addEventListener("change",e=>{CURRENTANSWER=e.srcElement.value}),questionObserver()}static displayAnswers(e){if(document.getElementsByClassName("sc-gBGeja eYKMSX")[0].textContent=e,""==e)document.getElementsByClassName("sc-gBGeja eYKMSX")[0].style.backgroundColor="#777777";else{document.getElementsByClassName("sc-gBGeja eYKMSX")[0].style.backgroundColor="#00aa00";var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}}function get_question(){var e=document.getElementsByClassName("sc-bKcCCv lfxIUK")[0].children[0].children[0].textContent,t="",n=[];if(document.getElementsByClassName("notranslate lang-en").length>1){t="multiple_choice";for(var s=1;s<document.getElementsByClassName("notranslate lang-en").length;s++)n.push(document.getElementsByClassName("notranslate lang-en")[s].textContent)}else t="text_response";return{text:e,type:t,answer_options:n}}function update(){var e=CURRENTQUESTION,t=CURRENTANSWER,n=RESULT;"multiple_choice"==e.type?(n?multiple_choice.modifyAnswers(MC.savedAnswers[MC.savedText.indexOf(e.text)],[t],[],[]):multiple_choice.modifyAnswers(MC.savedAnswers[MC.savedText.indexOf(e.text)],[],[t],[]),multiple_choice.modifyAnswers(MC.savedAnswers[MC.savedText.indexOf(e.text)],[],[],e.answer_options.splice(e.answer_options.indexOf(t),1))):n&&text_response.modifyAnswers(TR.savedAnswers[TR.savedText.indexOf(e.text)],t)}function questionObserver(){var e=new MutationObserver(()=>{e.disconnect(),(e=new MutationObserver(()=>{RESULT=wasAnswerRight(),update(),e.disconnect()})).observe(document.getElementsByClassName("sc-HWglP dnSgUS")[0].children[0],{attributes:!0,childList:!0})});e.observe(document.getElementsByClassName("sc-HWglP dnSgUS")[0].children[0],{attributes:!0,childList:!0})}function wasAnswerRight(){var e=document.getElementsByClassName("sc-bKcCCv lfxIUK")[0].children[0].children[0].textContent;return(e=parseInt(e.replace("$","")))>0}function join(e){if(console.log(e),null!=e.choice_data.savedText.length)for(var t=e.choice_data.savedText,n=e.choice_data.savedAnswers,s=0;s<t.length;s++){var a=t[s],r=n[s];0!=MC.savedText.length&&MC.savedText.includes(a)?multiple_choice.modifyAnswers(MC.savedAnswers[MC.savedText.indexOf(a)],r.correctAnswers,r.incorrectAnswers,r.unknownAnswers):multiple_choice.addQuestion(a,r.correctAnswers,r.incorrectAnswers,r.unknownAnswers)}if(null!=e.text_data.savedText.length){var l=e.text_data.savedText,o=e.text_data.savedAnswers;for(s=0;s<l.length;s++){a=l[s];var c=o[s].answer;if(0!=TR.savedText.length)if(TR.savedText.includes(a)){var i=TR.savedText.indexOf(a);""==TR.savedAnswers[i]&&text_response.modifyAnswers(a,c)}else text_response.addQuestion(a,c);else text_response.addQuestion(a,c)}}}function save(e="Gimkit.data"){var t=document.createElement("a"),n=JSON.stringify({text_data:TR,choice_data:MC}),s=new Blob([n],{type:"text/plain"});t.setAttribute("download",e);var a=window.URL.createObjectURL(s);t.href=a,t.click()}function load(e){if(0!=e.files.length){var t=new FileReader;t.onload=(()=>{join(JSON.parse(t.result))}),t.readAsText(e.files[0])}}var MC={savedText:[],savedAnswers:[]},TR={savedText:[],savedAnswers:[]},TOGGLESAVE=!1,CURRENTQUESTION=null,CURRENTANSWER=null,RESULT=null;function start(){document.addEventListener("keydown",e=>{if(27==e.keyCode)if(TOGGLESAVE)if(CURRENTQUESTION=get_question(),"multiple_choice"==CURRENTQUESTION.type){multiple_choice.setUp();var eval=multiple_choice.answer(CURRENTQUESTION.text,CURRENTQUESTION.answer_options);multiple_choice.displayAnswers(eval)}else{text_response.setUp();var eval=text_response.answer(CURRENTQUESTION.text);text_response.displayAnswers(eval)}else{TOGGLESAVE=!0;var saveEl=document.createElement("input");saveEl.style.backgroundColor="#000000",saveEl.setAttribute("type","button"),saveEl.setAttribute("value","Save"),saveEl.addEventListener("click",()=>{save(prompt("Filename","Gimkit.data"))});var bar=document.getElementsByClassName("sc-cNWTVD kflTld")[0];bar.appendChild(saveEl),bar.insertBefore(saveEl,bar.children[bar.children.length-2]);var loadEl=document.createElement("input");loadEl.style.color="transparent",loadEl.setAttribute("type","file"),loadEl.addEventListener("input",()=>{load(loadEl)}),bar.appendChild(loadEl),bar.insertBefore(loadEl,bar.children[bar.children.length-2])}17==e.keyCode&&2==e.location&&save()})}start();
